<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>HKUST RWA Exchange</title>
    <!-- å¼•å…¥åº“ -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- å¼•å…¥ç¾åŒ–åçš„ CSS -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <!-- ä¾§è¾¹æ  -->
    <nav class="sidebar">
        <div class="brand">
            <div class="brand-icon"><i class="fas fa-cube"></i></div>
            <div class="brand-text">
                <h4>RWA.Fi</h4>
                <small>HKUST Demo</small>
            </div>
        </div>
        
        <div class="nav-section-label">Marketplace</div>
        <div onclick="nav('market')" class="nav-item active" id="nav-market"><i class="fas fa-store"></i> äº¤æ˜“å¸‚åœº</div>
        <div onclick="nav('profile')" class="nav-item" id="nav-profile"><i class="fas fa-wallet"></i> æˆ‘çš„èµ„äº§ (Sell)</div>

        <div class="admin-only">
            <div class="nav-section-label">Admin Console</div>
            <div onclick="nav('issuer')" class="nav-item" id="nav-issuer"><i class="fas fa-stamp"></i> å‘è¯ç®¡ç† (Maker)</div>
            <div onclick="nav('logs')" class="nav-item" id="nav-logs"><i class="fas fa-list-ul"></i> å®¡è®¡æ—¥å¿—</div>
        </div>

        <div class="root-only">
            <div class="nav-section-label">Governance</div>
            <div onclick="nav('admin')" class="nav-item" id="nav-admin"><i class="fas fa-layer-group"></i> èµ„äº§ä¸Šæ¶</div>
            <div onclick="nav('gov')" class="nav-item" id="nav-gov"><i class="fas fa-building-columns"></i> æœºæ„ç›‘ç®¡</div>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹ -->
    <div class="main-content">
        
        <!-- é¡¶éƒ¨ -->
        <div class="top-bar">
            <div class="page-title">
                <h2 id="page-header-title">äº¤æ˜“å¸‚åœº</h2>
                <p>åŸºäºåŒºå—é“¾çš„å»ä¸­å¿ƒåŒ–å®ç‰©èµ„äº§äº¤æ˜“å¹³å°ã€‚</p>
            </div>
            <div class="user-bar">
                <div class="d-flex align-items-center gap-2 text-success fw-bold" style="font-size:0.8rem">
                    <i class="fas fa-circle" style="font-size:8px"></i> RPC Online
                </div>
                <div class="balance-badge"><span id="hkc-bal">0.00</span> HKC</div>
                <button onclick="connectWallet()" id="btn-conn" class="btn btn-primary-custom btn-sm">è¿æ¥é’±åŒ…</button>
                <div id="wallet-badge" class="wallet-badge d-none">0x...</div>
            </div>
        </div>

        <!-- 1. å¸‚åœº (Market) -->
        <div id="view-market" class="view-section active">
            <div class="d-flex justify-content-end mb-4">
                <button class="btn-outline" onclick="approveHKC()"><i class="fas fa-key me-2"></i> èµ„é‡‘æˆæƒ (Approve)</button>
            </div>
            <div class="row g-4" id="market-grid">
                <div class="col-12 text-center py-5 text-muted">
                    <div class="spinner-border text-primary mb-2"></div>
                    <p>Loading Assets...</p>
                </div>
            </div>
        </div>

        <!-- 2. ä¸ªäººä¸­å¿ƒ (Profile) -->
        <div id="view-profile" class="view-section">
            <div class="row mb-5">
                <div class="col-md-8">
                    <div class="card-box bg-primary text-white border-0" style="background:linear-gradient(135deg, #2563eb, #1e40af)">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <span class="badge bg-grey bg-opacity-20 mb-2">æ•°å­—èº«ä»½ (DID)</span>
                                <h2 class="fw-bold mb-1" id="my-role-display">æœªè¿æ¥</h2>
                                <div class="mt-3 opacity-75" id="my-org-display">è¯·è¿æ¥é’±åŒ…æŸ¥çœ‹è¯¦æƒ…</div>
                            </div>
                            <i class="fas fa-id-card fa-5x opacity-20"></i>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card-box h-100 d-flex flex-column justify-content-center align-items-center">
                        <h6 class="text-uppercase text-muted fw-bold small">æŒæœ‰èµ„äº§æ€»æ•°</h6>
                        <h1 class="fw-bold text-dark m-0" id="my-asset-count">0</h1>
                    </div>
                </div>
            </div>
            <h5 class="fw-bold mb-4">ğŸ“¦ æˆ‘çš„æŒä»“ (Inventory)</h5>
            <div class="row g-4" id="inventory-grid">
                <div class="col-12 text-center py-5 text-muted">æš‚æ— æŒä»“</div>
            </div>
        </div>

        <!-- 3. å‘è¯ (Issuer - MultiSig/Root) -->
        <div id="view-issuer" class="view-section">
            <div class="row g-4">
                <div class="col-md-5">
                    <div class="card-box" style="border-top:4px solid #f59e0b">
                        <div class="card-header-flex">
                            <h5 class="card-label text-warning" id="issue-title">å‘è¯æ“ä½œ</h5>
                        </div>
                        <p class="text-muted small mb-3" id="issue-desc">æ­£åœ¨æ£€æµ‹æ‚¨çš„æƒé™...</p>
                        
                        <div class="input-group mb-3">
                            <input id="targetUser" class="form-control" placeholder="ç›®æ ‡ç”¨æˆ·åœ°å€ (0x...)">
                            <button class="btn btn-outline-secondary" type="button" onclick="fillMyAddress()">å¡«è‡ªå·±</button>
                        </div>

                        <div class="row g-2 mb-4">
                            <div class="col"><select id="targetRegion" class="form-select"><option value="HK">HK é¦™æ¸¯</option><option value="US">US ç¾å›½</option></select></div>
                            <div class="col"><select id="targetRole" class="form-select"><option value="Student">Student</option><option value="Investor">Investor</option></select></div>
                        </div>
                        <div id="issue-btn-area"><button class="btn btn-secondary w-100" disabled>è¯·è¿æ¥é’±åŒ…</button></div>
                    </div>
                </div>
                <div class="col-md-7">
                    <div class="card-box">
                        <div class="card-header-flex">
                            <h5 class="card-label">å¾…å®¡æ‰¹åˆ—è¡¨ (Checker)</h5>
                            <button class="btn btn-sm btn-outline" onclick="loadProposals()"><i class="fas fa-sync"></i></button>
                        </div>
                        <table class="table-clean">
                            <thead><tr><th>ID</th><th>ç”¨æˆ·</th><th>è§’è‰²</th><th>å‘èµ·äºº</th><th>æ“ä½œ</th></tr></thead>
                            <tbody id="proposal-table"><tr><td colspan="5" class="text-center text-muted">æ— å¾…åŠäº‹é¡¹</td></tr></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- 4. èµ„äº§ç®¡ç† (Root Only) -->
        <div id="view-admin" class="view-section">
            <div class="card-box">
                <h5 class="card-label mb-4 text-success">ä¸Šæ¶æ–°èµ„äº§</h5>
                <div class="row g-3 align-items-end">
                    <div class="col-md-5">
                        <label class="small fw-bold text-muted">åç§°</label>
                        <input id="newAssetName" class="form-control" placeholder="e.g. Tokenized Gold">
                    </div>
                    <div class="col-md-3">
                        <label class="small fw-bold text-muted">ä»·æ ¼ (HKC)</label>
                        <input id="newAssetPrice" type="number" class="form-control" placeholder="100">
                    </div>
                    <div class="col-md-2">
                        <label class="small fw-bold text-muted">åœ°åŒºé™åˆ¶</label>
                        <select id="newAssetRegion" class="form-select"><option value="">Global</option><option value="HK">HK Only</option></select>
                    </div>
                    <div class="col-md-2"><button onclick="addAsset()" class="btn btn-primary-custom w-100">ä¸Šæ¶</button></div>
                </div>
            </div>
            <div class="card-box">
                <h5 class="card-label mb-4">ç°å­˜èµ„äº§åˆ—è¡¨</h5>
                <table class="table-clean">
                    <thead><tr><th>ID</th><th>åç§°</th><th>ä»·æ ¼</th><th>çŠ¶æ€</th><th>æ“ä½œ</th></tr></thead>
                    <tbody id="admin-table"></tbody>
                </table>
            </div>
        </div>

        <!-- 5. ç›‘ç®¡ (Root Only) -->
        <div id="view-gov" class="view-section">
            <div class="row g-4">
                <div class="col-md-5">
                    <div class="card-box" style="border-top:4px solid #ef4444">
                        <h5 class="card-label text-danger mb-4">æœºæ„ç›‘ç®¡ & æˆæƒ</h5>
                        <div class="mb-3">
                            <label class="small fw-bold text-muted">æ·»åŠ æœºæ„</label>
                            <div class="input-group mt-1">
                                <input id="issuerAddr" class="form-control" placeholder="æœºæ„åœ°å€">
                                <input id="issuerName" class="form-control" placeholder="åç§°">
                            </div>
                            <div class="d-flex gap-2 mt-2">
                                <button onclick="govAdd()" class="btn btn-outline w-50 text-success fw-bold">æˆæƒ</button>
                                <button onclick="govRevoke()" class="btn btn-outline w-50 text-danger fw-bold">åŠé”€</button>
                            </div>
                        </div>
                        <hr>
                        <div class="mb-2">
                            <label class="small fw-bold text-muted">ç»‘å®šç®¡ç†å‘˜</label>
                            <input id="adminAddr" class="form-control mt-1 mb-2" placeholder="ç®¡ç†å‘˜åœ°å€">
                            <input id="bindOrgAddr" class="form-control mb-2" placeholder="æ‰€å±æœºæ„åœ°å€">
                            <button onclick="govAddAdmin()" class="btn btn-primary-custom w-100">ç»‘å®š (Add Admin)</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-7">
                    <div class="card-box">
                        <h5 class="card-label mb-4">å·²æˆæƒæœºæ„</h5>
                        <table class="table-clean"><tbody id="issuer-list-tbody"></tbody></table>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 6. Logs -->
        <div id="view-logs" class="view-section">
            <div class="card-box">
                <h5 class="card-label mb-4">ç³»ç»Ÿå®¡è®¡æ—¥å¿—</h5>
                <table class="table-clean">
                    <thead><tr><th>Type</th><th>Detail</th><th>TxHash</th></tr></thead>
                    <tbody id="logs-table"></tbody>
                </table>
            </div>
        </div>

    </div>

    <script>
        // ==================== âš ï¸ å¡«å…¥ SystemV9/V14 åˆçº¦åœ°å€ ====================
        const ADDR_HKC      = "0xd52dC3Bd38Ce3Bc0C4A8e9D0da559F68D2aeD998";
        const ADDR_ID       = "0x9D22783ae7b6E933173fc341cdc1E4E5da3BF3A4";
        const ADDR_MARKET   = "0xDd9B33cA55aB5DA06094cb649267CD9690af0005";
        
        const RPC_URL     = "https://ethereum-sepolia.publicnode.com"; 
        // ======================================================================

        const ABI_ID = ["function rootIssue(address,string,string,uint256) external", "function proposeIdentity(address,string,string,uint256) external", "function approveIdentity(uint256) external", "function owner() view returns (address)", "function proposalCount() view returns (uint256)", "function getProposal(uint256) view returns (tuple(uint256 id, address targetUser, string region, string role, uint256 validityDays, address proposer, bool executed))", "function identities(address) view returns (address issuedBy, string region, string role, uint256 expiry, bool isValid)", "function issuers(address) view returns (bool isActive, string name)", "function getAllIssuers() view returns (address[])", "function addIssuer(address,string) external", "function revokeIssuer(address) external", "function addAdmin(address,address) external", "function getAdminOrg(address) view returns (address)"];
        const ABI_MKT = ["function addAsset(string,uint256,string,address) external", "function buyAsset(uint256) external", "function sellAsset(uint256) external", "function userBalances(address,uint256) view returns (uint256)", "function assetCount() view returns (uint256)", "function assets(uint256) view returns (string name, uint256 price, string requiredRegion, address requiredIssuer, bool isActive)", "function setAssetStatus(uint256, bool) external", "event TradeExecuted(address,string,uint256,string,uint256,uint256)"];
        const ABI_HKC = ["function approve(address,uint256) external", "function balanceOf(address) view returns (uint256)"];

        let signer, myAddr, cID, cMKT, cHKC, provider;

        window.onload = async () => {
            try {
                provider = new ethers.providers.JsonRpcProvider(RPC_URL);
                initContracts(provider);
                loadAssets();
            } catch(e){}
        };

        function initContracts(p) {
            cID = new ethers.Contract(ADDR_ID, ABI_ID, p);
            cMKT = new ethers.Contract(ADDR_MARKET, ABI_MKT, p);
            cHKC = new ethers.Contract(ADDR_HKC, ABI_HKC, p);
        }

        async function connectWallet() {
            if(!window.ethereum) return Swal.fire("Error", "Please Install MetaMask", "error");
            try {
                const p = new ethers.providers.Web3Provider(window.ethereum);
                await p.send("eth_requestAccounts", []);
                signer = p.getSigner();
                myAddr = await signer.getAddress();
                
                document.getElementById("btn-conn").style.display="none";
                document.getElementById("wallet-badge").innerText = myAddr.slice(0,6)+"...";
                document.getElementById("wallet-badge").classList.remove("d-none");
                
                initContracts(signer);
                await checkRole(); 
                refreshAll();
            } catch(e) { console.error(e); }
        }

        function fillMyAddress() { document.getElementById("targetUser").value = myAddr; }

        async function checkRole() {
            const area = document.getElementById("issue-btn-area");
            const title = document.getElementById("issue-title");
            const desc = document.getElementById("issue-desc");

            try {
                const owner = await cID.owner();
                
                // Root åˆ¤æ–­
                if(owner.toLowerCase() === myAddr.toLowerCase()) {
                    document.getElementById("my-role-display").innerText = "Root Admin";
                    document.getElementById("my-org-display").innerText = "System Owner";
                    document.querySelectorAll(".root-only, .admin-only").forEach(e=>e.style.setProperty("display","block","important"));
                    
                    title.innerHTML = "<span class='text-danger'>ğŸš€ Root æé€Ÿå‘è¯</span>";
                    desc.innerText = "æ— éœ€å®¡æ ¸ï¼Œç›´æ¥å‘è¯ã€‚";
                    area.innerHTML = `<button onclick="rootIssue()" class="btn-primary-custom w-100" style="background:#dc2626">ç«‹å³å‘è¯ (Root)</button>`;
                    return;
                }

                // Admin åˆ¤æ–­
                const orgAddr = await cID.getAdminOrg(myAddr);
                if(orgAddr !== "0x0000000000000000000000000000000000000000") {
                    const orgInfo = await cID.issuers(orgAddr);
                    document.getElementById("my-role-display").innerText = "Admin";
                    document.getElementById("my-org-display").innerText = orgInfo.name;
                    document.querySelectorAll(".admin-only").forEach(e=>e.style.setProperty("display","block","important"));
                    
                    title.innerText = "å‘èµ·ææ¡ˆ (Maker)";
                    desc.innerText = "éœ€å¤æ ¸ã€‚";
                    area.innerHTML = `<button onclick="proposeID()" class="btn-primary-custom w-100" style="background:#f59e0b">å‘èµ·ææ¡ˆ</button>`;
                    return;
                }

                // User åˆ¤æ–­
                const id = await cID.identities(myAddr);
                if(id.isValid) {
                    document.getElementById("my-role-display").innerText = id.role;
                    document.getElementById("my-org-display").innerText = "Region: "+id.region;
                } else {
                    document.getElementById("my-role-display").innerText = "æ— æœ‰æ•ˆèº«ä»½";
                }
                document.querySelectorAll(".admin-only, .root-only").forEach(e=>e.style.setProperty("display","none","important"));

            } catch(e) { console.warn(e); }
        }

        async function ensureSigner() { if(signer) return true; await connectWallet(); return !!signer; }
        async function tx(p, msg) {
            if(!await ensureSigner()) return;
            try {
                Swal.fire({title:'ç¡®è®¤...', didOpen:()=>Swal.showLoading()});
                const t = await p;
                Swal.fire({title:'ä¸Šé“¾ä¸­...', didOpen:()=>Swal.showLoading()});
                await t.wait();
                Swal.fire("æˆåŠŸ", msg, "success");
                refreshAll();
            } catch(e) { 
                let err = e.reason || e.message;
                if(err.includes("Identity Invalid")) err = "è´­ä¹°å¤±è´¥ï¼šä½ æ²¡æœ‰æœ‰æ•ˆèº«ä»½ï¼ˆè¯·å»å‘è¯é¡µé¢ï¼‰";
                Swal.fire("é”™è¯¯", err, "error"); 
            }
        }

        function refreshAll() { loadAssets(); if(signer) { loadUserData(); loadProposals(); loadIssuerList(); loadLogs(); } }

        // Actions
        function rootIssue() { 
            const u=document.getElementById("targetUser").value || myAddr;
            const r=document.getElementById("targetRegion").value, role=document.getElementById("targetRole").value;
            tx(cID.connect(signer).rootIssue(u,r,role,365), "Rootå‘è¯æˆåŠŸ");
        }
        function proposeID() { 
            const u=document.getElementById("targetUser").value, r=document.getElementById("targetRegion").value, role=document.getElementById("targetRole").value;
            tx(cID.connect(signer).proposeIdentity(u,r,role,365), "ææ¡ˆæäº¤");
        }
        
        function approveHKC() { tx(cHKC.connect(signer).approve(ADDR_MARKET, ethers.constants.MaxUint256), "æˆæƒæˆåŠŸ"); }
        function buy(id) { tx(cMKT.connect(signer).buyAsset(id), "è´­ä¹°æˆåŠŸ"); }
        function sell(id,n,p) { tx(cMKT.connect(signer).sellAsset(id), "å–å‡ºæˆåŠŸ"); }
        function addAsset() { tx(cMKT.connect(signer).addAsset(document.getElementById("newAssetName").value, document.getElementById("newAssetPrice").value, "", "0x0000000000000000000000000000000000000000"), "ä¸Šæ¶æˆåŠŸ"); }
        function toggle(id,s) { tx(cMKT.connect(signer).setAssetStatus(id,s), "çŠ¶æ€æ›´æ–°"); }
        function govAdd() { tx(cID.connect(signer).addIssuer(document.getElementById("issuerAddr").value, document.getElementById("issuerName").value), "æˆæƒæˆåŠŸ"); }
        function govAddAdmin() { tx(cID.connect(signer).addAdmin(document.getElementById("adminAddr").value, document.getElementById("bindOrgAddr").value), "ç»‘å®šæˆåŠŸ"); }
        function govRevoke() { tx(cID.connect(signer).revokeIssuer(document.getElementById("issuerAddr").value), "åŠé”€æˆåŠŸ"); }
        async function approveID(id) { tx(cID.connect(signer).approveIdentity(id), "å®¡æ‰¹é€šè¿‡"); }

        async function loadAssets() {
            const g=document.getElementById("market-grid"), t=document.getElementById("admin-table");
            if(!cMKT) return; g.innerHTML=""; t.innerHTML="";
            try {
                const c = await cMKT.assetCount();
                if(c.toNumber()===0) g.innerHTML="<div class='col-12 text-center text-muted py-5'>æš‚æ— èµ„äº§</div>";
                for(let i=1; i<=c; i++) {
                    const a = await cMKT.assets(i);
                    // ç»„è£… HTML å­—ç¬¦ä¸²
                    let statusBadge = a.isActive ? '<span class="badge bg-success bg-opacity-10 text-success">Active</span>' : '<span class="badge bg-danger bg-opacity-10 text-danger">Inactive</span>';
                    let btnBuy = a.isActive ? `<button onclick="buy(${i})" class="btn btn-sm btn-primary-custom">è´­ä¹°</button>` : `<button disabled class="btn btn-sm btn-secondary">ä¸‹æ¶</button>`;
                    
                    // Market View
                    if(a.isActive) {
                        const hue = (i*137)%360;
                        g.innerHTML += `
                        <div class="col-md-4 mb-4">
                            <div class="asset-card">
                                <div class="asset-visual">
                                    <i class="fas fa-cube asset-icon-lg"></i>
                                    <span class="asset-tag">${a.requiredRegion||'GLOBAL'}</span>
                                </div>
                                <div class="asset-content">
                                    <div class="asset-title">${a.name}</div>
                                    <div class="asset-id">ID: #${i}</div>
                                    <div class="asset-price-row">
                                        <div class="price-val">${a.price} <span class="price-unit">HKC</span></div>
                                        ${btnBuy}
                                    </div>
                                </div>
                            </div>
                        </div>`;
                    }
                    // Admin View
                    t.innerHTML+=`<tr><td>${i}</td><td><strong>${a.name}</strong></td><td>${a.price} HKC</td><td>${statusBadge}</td><td><button onclick="toggle(${i},${!a.isActive})" class="btn btn-sm btn-outline">Toggle</button></td></tr>`;
                }
            } catch(e){}
        }

        async function loadUserData() {
            if(!signer) return;
            const bal = await cHKC.balanceOf(myAddr);
            document.getElementById("hkc-bal").innerText = ethers.utils.formatUnits(bal, 18).split('.')[0];
            
            const g = document.getElementById("inventory-grid"); g.innerHTML="";
            const c = await cMKT.assetCount();
            let has=false, count=0;
            for(let i=1; i<=c; i++) {
                const b = await cMKT.userBalances(myAddr, i);
                if(b.gt(0)) {
                    has=true; count+=b.toNumber(); const a = await cMKT.assets(i);
                    g.innerHTML+=`<div class="col-md-4"><div class="card-box text-center" style="border:1px solid var(--success);"><h5 class="fw-bold text-success">${a.name}</h5><span class="badge bg-success mb-3">æŒæœ‰: ${b}</span><button onclick="sell(${i},'${a.name}',${a.price})" class="btn btn-outline-danger w-100 btn-sm fw-bold">å–å‡ºå˜ç°</button></div></div>`;
                }
            }
            if(!has) g.innerHTML="<div class='col-12 text-center text-muted py-5'>æš‚æ— æŒä»“</div>";
            document.getElementById("my-asset-count").innerText = count;
        }

        async function loadProposals() {
            const t = document.getElementById("proposal-table"); t.innerHTML="";
            try {
                const c = await cID.proposalCount();
                for(let i=c; i>Math.max(0,c-5); i--) {
                    const p = await cID.getProposal(i);
                    if(!p.executed) t.innerHTML+=`<tr><td>#${p.id}</td><td>${p.targetUser.slice(0,6)}...</td><td>${p.role}</td><td>${p.proposer.slice(0,6)}...</td><td><button onclick="approveID(${p.id})" class="btn btn-sm btn-primary-custom">æ‰¹å‡†</button></td></tr>`;
                }
            } catch(e){}
        }
        
        async function loadIssuerList() {
            const t = document.getElementById("issuer-list-tbody"); t.innerHTML="";
            try {
                const l = await cID.getAllIssuers();
                for(let a of l) { const i = await cID.issuers(a); if(i.name) t.innerHTML+=`<tr><td><strong>${i.name}</strong></td><td class="text-muted small font-monospace">${a}</td><td>${i.isActive?'âœ…':'âŒ'}</td></tr>`; }
            } catch(e){}
        }

        async function loadLogs() {
            const t=document.getElementById("logs-table"); t.innerHTML="";
            const l=await cMKT.queryFilter("TradeExecuted", -2000);
            for(let i=l.length-1; i>=0; i--) {
                const e=l[i]; t.innerHTML+=`<tr><td><span class="badge bg-primary bg-opacity-10 text-primary border border-primary">${e.args.type_}</span></td><td>ç”¨æˆ· ${e.args.user.slice(0,6)} æ“ä½œäº† <strong>${e.args.assetName}</strong></td><td><a href="https://sepolia.etherscan.io/tx/${e.transactionHash}" target="_blank" class="text-decoration-none">View</a></td></tr>`;
            }
        }

        function nav(p) {
            document.querySelectorAll('.view-section').forEach(e=>e.classList.remove('active')); document.getElementById('view-'+p).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(e=>e.classList.remove('active')); document.getElementById('nav-'+p).classList.add('active');
            document.getElementById('page-header-title').innerText = {market:'äº¤æ˜“å¸‚åœº',profile:'æˆ‘çš„èµ„äº§',issuer:'å‘è¯ç®¡ç†',admin:'èµ„äº§ç®¡ç†',gov:'æœºæ„ç›‘ç®¡',logs:'å®¡è®¡æ—¥å¿—'}[p];
            if(signer) refreshAll();
        }
    </script>
</body>
</html>
